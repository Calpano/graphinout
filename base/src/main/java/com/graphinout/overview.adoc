= GraphInOut Base Module Overview
:toc:
:toclevels: 3

== Introduction

=== Old

.The Old Approach before CJ
[plantuml]
....
hide empty members
hide circle

' fix plantuml font rendering
skinparam lengthAdjust none
skinparam padding 2

interface Bytes_in as "Bytes<<in>>" {
    java.io.InputStream
}
interface Characters_in as "Characters<<in>>" {
    java.io.Reader
}
interface XML_in as "XML<<in>>" {
    XmlWriter
}
interface GraphML_in as "GraphML<<in>>" {
    GraphmlWriter
}
interface Text_in as "Text<<in>>"
interface Gio as "Gio" {
    GioWriter
}
'out
interface Bytes_out as "Bytes<<out>>" {
    java.io.OutputStream
}
interface Characters_out as "Characters<<out>>" {
    Appendable
}
interface XML_out as "XML<<out>>" {
    XmlWriter
}
interface GraphML_out as "GraphML<<out>>" {
    GraphmlWriter
}

Bytes_in --u> Characters_in : decode UTF-8
Characters_in --u> XML_in
Characters_in --u> Text_in
XML_in --u> GraphML_in
GraphML_in --u> Gio
Text_in --u> Gio
Gio --> GraphML_out

GraphML_out --> XML_out
XML_out --> Characters_out
Characters_out --> Bytes_out
....

=== Transition

.The Whole Picture
[plantuml]
....
hide empty members
hide circle

' fix plantuml font rendering
skinparam lengthAdjust none
skinparam padding 2

interface Bytes_in as "Bytes<<in>>" {
    java.io.InputStream
}
interface Characters_in as "Characters<<in>>" {
    java.io.Reader
}
interface JSON_in as "JSON<<in>>" {
    JsonWriter
}
interface XML_in as "XML<<in>>" {
    XmlWriter
}
interface GraphML_in as "GraphML<<in>>" {
    GraphmlWriter
}
interface Text_in as "Text<<in>>"
interface CJ_in as "CJ<<in>>" {
    CjWriter
}
interface Gio as "Gio" {
    GioWriter
}
'out
interface Bytes_out as "Bytes<<out>>" {
    java.io.OutputStream
}
interface Characters_out as "Characters<<out>>" {
    Appendable
}
interface JSON_out as "JSON<<out>>"  {
    JsonWriter
}
interface XML_out as "XML<<out>>" {
    XmlWriter
}
interface GraphML_out as "GraphML<<out>>" {
    GraphmlWriter
}
interface CJ_out as "CJ<<out>>" {
    CjWriter
}

Bytes_in --u> Characters_in : decode UTF-8
Characters_in --u> JSON_in
Characters_in --u> XML_in
Characters_in --u> Text_in
JSON_in --u> CJ_in : CJ,\nExtended CJ
CJ_in --u> Gio
Gio --> CJ_out
CJ_out --> JSON_out : CJ
XML_in --u> GraphML_in
GraphML_in --u> Gio
Text_in --u> Gio
Gio --> GraphML_out : Gio2GraphmlWriter

JSON_out --> Characters_out

'Bytes_in ...... Bytes_out
'Characters_in .... Characters_out
'JSON_in .... JSON_out
'XML_in .... XML_out
'Text_in .... Text_out
'CJ_in .... CJ_out

GraphML_out --> XML_out
XML_out --> Characters_out
Characters_out --> Bytes_out
....

== Focused / Planned

Our planned architecture.
Over time, the Gio-layer might be fully replaced by the CJ later.

.Planned
[plantuml]
....
hide empty members
hide circle

CJ_in .> CJ_out : maybe
' fix plantuml font rendering
skinparam lengthAdjust none
skinparam padding 2

interface Characters_in as "Characters<<in>>" {
    java.io.Reader
}
interface JSON_in as "JSON<<in>>" {
    JsonWriter
}
interface XML_in as "XML<<in>>" {
    XmlWriter
}
interface GraphML_in as "GraphML<<in>>" {
    GraphmlWriter
}
interface Text_in as "Text<<in>>"
interface CJ_in as "CJ<<in>>" {
    CjWriter
}
interface Gio as "Gio" {
    GioWriter
}
'out
interface Characters_out as "Characters<<out>>" {
    Appendable
}
interface JSON_out as "JSON<<out>>"  {
    JsonWriter
}
interface XML_out as "XML<<out>>" {
    XmlWriter
}
interface GraphML_out as "GraphML<<out>>" {
    GraphmlWriter
}
interface CJ_out as "CJ<<out>>" {
    CjWriter
}

Characters_in -[hidden]> Characters_out
Characters_in --u> JSON_in
Characters_in --u> XML_in
Characters_in --u> Text_in
JSON_in --u> CJ_in : CJ,\nExtended CJ\n\nJson2CjWriter
CJ_in --u> Gio : Cj2GioWriter
Gio --> CJ_out : Gio2CjWriter
CJ_out --> JSON_out : CJ\n\nCj2JsonWriter
XML_in --u> GraphML_in
GraphML_in --u[#red]> CJ_in
Text_in --u[#red]> CJ_in
CJ_out --[#red]> GraphML_out

JSON_out --> Characters_out

GraphML_out --> XML_out
XML_out --> Characters_out
....

=== Round-Trip Testing

For XML, JSON and (canonical) CJ, we can expect perfect round-tripping.

For parsing involving GraphML and Gio, this can in general not be expected.

.XML Infra
[plantuml]
....
hide empty members
hide circle

' fix plantuml font rendering
skinparam lengthAdjust none
skinparam padding 2

interface Characters_in as "Characters<<in>>" {
    java.io.Reader
}
interface XML_in as "XML<<in>>" {
    XmlWriter
}
'out
interface Characters_out as "Characters<<out>>" {
    Appendable
}
interface XML_out as "XML<<out>>" {
    XmlWriter
}
Characters_in -[hidden]> Characters_out
Characters_in --u> XML_in
XML_out --> Characters_out
XML_in -[#blue]> XML_out : delegate
....

.JSON Infra
[plantuml]
....
hide empty members
hide circle

' fix plantuml font rendering
skinparam lengthAdjust none
skinparam padding 2

interface Characters_in as "Characters<<in>>" {
    java.io.Reader
}
interface JSON_in as "JSON<<in>>" {
    JsonWriter
}
'out
interface Characters_out as "Characters<<out>>" {
    Appendable
}
interface JSON_out as "JSON<<out>>" {
    JsonWriter
}
Characters_in -[hidden]> Characters_out
Characters_in --u> JSON_in
JSON_out --> Characters_out
JSON_in -[#blue]> JSON_out : delegate
....

.CJ Infra
[plantuml]
....
hide empty members
hide circle

' fix plantuml font rendering
skinparam lengthAdjust none
skinparam padding 2

interface Characters_in as "Characters<<in>>" {
    java.io.Reader
}
interface JSON_in as "JSON<<in>>" {
    JsonWriter
}
interface CJ_in as "CJ<<in>>" {
    CjWriter
}
'out
interface Characters_out as "Characters<<out>>" {
    Appendable
}
interface JSON_out as "JSON<<out>>"  {
    JsonWriter
}
interface CJ_out as "CJ<<out>>" {
    CjWriter
}

Characters_in -[hidden]> Characters_out
Characters_in --u> JSON_in
JSON_in --u> CJ_in : CJ,\n(Extended CJ)\n\nJson2CjWriter
CJ_out --> JSON_out : CJ\n\nCj2JsonWriter
JSON_out --> Characters_out
CJ_in -[#blue]> CJ_out : delegate
....

== Package Structure

The base module is organized into two main package hierarchies:

* `com.graphinout.base` - Core graph processing functionality
* `com.graphinout.foundation` - Foundational utilities and abstractions

== Core Packages (`com.graphinout.base`)

=== Base Package (`com.graphinout.base`)

Contains shared constants and core definitions used throughout the system.

=== CJ Package (`com.graphinout.base.cj`)

Provides support for the CJ (Compact JSON) graph format, a lightweight JSON-based representation of graphs.

.Key Classes
* `ICjWriter` - Interface for writing CJ format
* `CjDirection` - Enumeration for edge directions
* `ICjEdgeType` - Enumeration for edge types
* `CjConstants` - Constants for CJ format

.Implementation Package (`impl`)
* `CjLabelImpl` - Implementation of CJ labels
* `LoggingCjWriter` - CJ writer with logging capabilities

=== GIO Package (`com.graphinout.base.gio`)

Contains the core GIO (Graph Input/Output) model interfaces and classes that define the fundamental graph structure.

.Core Interfaces
* `CjDocumentElement` - Root document interface
* `CjGraphElement` - Graph container interface
* `CjNodeElement` - Graph node interface
* `CjEdgeElement` - Graph edge interface
* `GioElement` - Base element interface
* `GioReader` - Interface for reading GIO format
* `GioWriter` - Interface for writing GIO format

.Supporting Classes
* `CjEndpointElement` - Edge endpoint representation
* `CjPortElement` - Node port representation
* `GioKey` - Key definition for data attributes
* `GioData` - Data container for attributes
* `GioDataType` - Data type enumeration
* `Direction` - Direction enumeration
* `GioElementWithDescription` - Elements with description support

==== DOM Subpackage (`dom`)

Provides concrete DOM (Document Object Model) implementations of the GIO interfaces.

.Implementation Classes
* `CjDocumentElement` - DOM implementation of document
* `CjGraphElement` - DOM implementation of graph
* `CjNodeElement` - DOM implementation of node
* `CjEdgeElement` - DOM implementation of edge
* `CjEndpointElement` - DOM implementation of endpoint
* `CjPortElement` - DOM implementation of port
* `ICjElement` - Base class for extensible elements

=== GraphML Package (`com.graphinout.base.graphml`)

Comprehensive support for the GraphML format, including reading, writing, and validation.

.Core Classes
* `GraphmlDocument` - GraphML document representation
* `GraphmlGraph` - GraphML graph representation
* `GraphmlNode` - GraphML node representation
* `GraphmlEdge` - GraphML edge representation
* `GraphmlHyperEdge` - GraphML hyperedge support

.Data Handling
* `GraphmlData` - Data element representation
* `GraphmlKey` - Key definition for attributes
* `GraphmlKeyForType` - Type-specific key definitions
* `GraphmlDefault` - Default value handling

.Writers
* `GraphmlWriter` - Interface for GraphML writing
* `Graphml2XmlWriter` - Implementation of GraphML writer
* `DelegatingGraphmlWriter` - Delegating writer pattern
* `Gio2GraphmlWriter` - Converter from GIO to GraphML

.Utilities
* `GraphmlLocator` - Location tracking for parsing
* `GraphmlDirection` - Direction handling
* `BufferingJsonWriter` - Buffered JSON writing
* `IXmlElement` - XML value representation

=== Reader Package (`com.graphinout.base.reader`)

Provides common functionality for reading various graph formats.

.Error Handling
* `ContentError` - Individual content error representation
* `ContentErrors` - Collection of content errors
* `InMemoryErrorHandler` - In-memory error handling

.Location Tracking
* `Locator` - Interface for location tracking
* `Location` - Specific location representation

.Format Detection
* `GioFileFormat` - File format detection and identification

=== Validation Package (`com.graphinout.base.validation`)

Provides validation functionality for graph writers and formats.

.Exception Classes
* `GioWriterException` - Base GIO writer exception
* `GioWriterStartException` - GIO writer start exceptions
* `GioWriterEndException` - GIO writer end exceptions
* `GraphmlWriterException` - Base GraphML writer exception
* `GraphmlWriterStartException` - GraphML writer start exceptions
* `GraphmlWriterEndException` - GraphML writer end exceptions

=== Writer Package (`com.graphinout.base.writer`)

Contains various writer implementations and utilities for output generation.

.Utilities
* `NoopJsonWriter` - No-operation JSON writer

== Foundation Packages (`com.graphinout.foundation`)

=== Input Package (`com.graphinout.foundation.input`)

Provides abstractions and implementations for input sources.

.Core Interfaces
* `InputSource` - Base input source interface
* `SingleInputSource` - Single input source interface
* `MultiInputSource` - Multiple input source interface

.Implementations
* `FileSingleInputSource` - File-based single input
* `FilesMultiInputSource` - File-based multiple input
* `ByteArrayInputSource` - Byte array input source
* `SingleInputSourceOfString` - String-based input source

=== Output Package (`com.graphinout.foundation.output`)

Provides abstractions and implementations for output destinations.

.Core Interface
* `OutputSink` - Base output sink interface

.Implementations
* `FileOutputSink` - File-based output
* `InMemoryOutputSink` - In-memory output storage
* `NoopOutputSink` - No-operation output for testing

=== JSON Package (`com.graphinout.foundation.json`)

Comprehensive JSON processing capabilities.

.Core Interfaces
* `JsonWriter` - Interface for JSON writing
* `JsonReader` - Interface for JSON reading
* `JsonValueWriter` - Element-specific JSON writing

.Supporting Classes
* `JsonType` - JSON type enumeration
* `JsonException` - JSON processing exceptions

==== Implementation Subpackage (`impl`)

Concrete implementations of JSON processing interfaces.

.Writer Implementations
* `AppendableJsonWriter` - Appendable-based JSON writer
* `StringBuilderJsonWriter` - StringBuilder-based JSON writer
* `LoggingJsonWriter` - JSON writer with logging
* `ValidatingJsonWriter` - JSON writer with validation

==== Lab Subpackage (`lab`)

Experimental JSON features and extensions.

.Experimental Classes
* `ExtensibleJson` - Extensible JSON functionality

=== XML Package (`com.graphinout.foundation.xml`)

XML processing and writing capabilities.

.Core Classes
* `XmlWriter` - Interface for XML writing
* `XmlWriterImpl` - Implementation of XML writer
* `ValidatingXmlWriter` - XML writer with validation
* `Sax2Log` - SAX to logging bridge

== Architecture Overview

The base module follows a layered architecture:

1. **Foundation Layer** - Provides basic I/O abstractions, JSON/XML processing
2. **Core Model Layer** - Defines the GIO graph model and interfaces
3. **Format Support Layer** - Implements specific format support (GraphML, CJ)
4. **Validation Layer** - Provides validation and error handling
5. **Writer/Reader Layer** - Implements various input/output operations

This architecture ensures separation of concerns, extensibility, and maintainability while providing a robust foundation for graph data processing operations.
